{"remainingRequest":"/Users/mac/Documents/QL-HoSoBenhAn/medicalproject/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mac/Documents/QL-HoSoBenhAn/medicalproject/client/src/components/content/Doctor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mac/Documents/QL-HoSoBenhAn/medicalproject/client/src/components/content/Doctor.vue","mtime":1570373560000},{"path":"/Users/mac/Documents/QL-HoSoBenhAn/medicalproject/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mac/Documents/QL-HoSoBenhAn/medicalproject/client/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mac/Documents/QL-HoSoBenhAn/medicalproject/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mac/Documents/QL-HoSoBenhAn/medicalproject/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapGetters} from \"vuex\";\nimport DoctorService from '@/services/DoctorService'\nimport PageNotFound from '@/components/content/PageNotFound.vue'\nimport PatientView from '@/components/content/patient_modules/PatientView.vue'\nimport PatientData from '@/components/content/patient_modules/PatientData.vue'\nimport PatientService from '@/services/PatientService'\nimport HospitalService from '@/services/HospitalService'\nexport default {\n  data(){\n        return{\n            messageError:'',\n            doctor_email_record:'',          \n            doctor_right_record:'',\n            isWriteRecord:false,\n            error_access_record:null,\n            titleRecord:'',\n            diagnoseRecord:'',\n            errors: null,\n            Istruycap:false,\n            idRecord:null,\n            describe:'',\n            passwordchangeValue:'',\n            passwordchangeValueAgain:'',\n            get isUserLoggedIn() {\n                return localStorage.getItem('isUserLoggedIn' || false);\n              },\n            NewDrugs:[\n              {\n                name:'',\n                id_record:'',\n                total:'',\n                morning:'',\n                midday:'',\n                afternoon:'',\n                night:'',\n                note:'',\n              }\n            ],\n            \n            files: [],\n            isHideNewAlternativeRecord:true\n        }\n    },\n      computed: {\n        ...mapGetters([\"patient_records\",\"doctorInfo\",\"hospitalInfo\",\"patientInfo\"])\n      },\n      components: {\n        \"app-TimeLine\": PatientView,  \n        \"app-PatientData\": PatientData,\n        \"app-PageNotFound\":PageNotFound\n      },\n    async mounted() {\n        const userCONST = JSON.parse(localStorage.getItem('user'));\n        if(userCONST){\n          this.user = userCONST\n          const id_account = JSON.parse(localStorage.getItem('user')).id;\n\n          const payload_doctor = (await DoctorService.getInfoDoctor(id_account)).data\n          this.$store.dispatch(\"setDoctorInfo\",payload_doctor)\n\n          const payload_hospital = (await HospitalService.getInfoHospital(payload_doctor.id_hospital)).data\n          this.$store.dispatch(\"setHospitalInfo\",payload_hospital)\n        }\n        \n      },\n  methods: {\n      validationPasswordChange(){\n        if(!this.passwordchangeValue || !this.passwordchangeValueAgain){\n            this.$toasted.show('Vui Lòng Nhập Đầy Đủ Thông Tin !!!', { \n            theme: \"bubble\",\n            position: \"bottom-right\", \n            duration : 4000\n        });\n        }else if(this.passwordchangeValue !== this.passwordchangeValueAgain){\n          this.$toasted.show(`Mật Khẩu Và Mật Khẩu Xác Nhận Không Giống Nhau !!!<br>Vui Lòng Kiểm Tra Lại !!!`, { \n            theme: \"bubble\", \n            position: \"bottom-right\", \n            duration : 5000\n        });\n        }else if(this.passwordchangeValue.length < 8){\n          this.$toasted.show(`Mật khẩu được cung cấp phải khớp với các quy tắc sau:\\n            <br><br>\\n            1. Nó phải chứa chỉ các ký tự sau: chữ thường, chữ hoa, chữ số.\\n            <br><br>\\n            2. mật khẩu dài ít nhất 8 kí tự và không dài hơn 32 kí tự.\\n            </div>\\n        `, { \n            theme: \"bubble\", \n            position: \"bottom-right\", \n            duration : 4000\n        });\n        }else{\n          this.changepassword();\n          this.closeModal3();\n        }\n    },\n    closeModal3(){\n        this.passwordchangeValue = ''\n        this.passwordchangeValueAgain = ''\n        this.$root.$emit('bv::hide::modal', \"modal-3\", \"button\")\n      },\n    async changepassword(){\n        try {\n            await PatientService.changePassword({\n              id_account:this.user.id,\n              password:this.passwordchangeValue\n          })\n        } catch (error) {\n          this.ErrorToasted(error)\n        }\n\n            this.$toasted.show(`Cập Nhập Thành công !!`, { \n              theme: \"bubble\",\n              position: \"bottom-right\", \n              duration : 3000\n          });\n      },\n    addFiles(){\n      this.$refs.files.click()\n    },\n    checkForm: function (e) {\n      if (this.titleRecord && this.diagnoseRecord) {\n        this.save()\n      }\n      this.errors = '';\n\n      if (!this.titleRecord) {\n        this.errors += 'Vui lòng nhập triệu chứng, lý do. <br> ';\n      }\n      if (!this.diagnoseRecord) {\n        this.errors += 'Vui lòng nhập chẩn đoán.';\n      }\n        this.$toasted.show(`${this.errors}`, {\n          theme: \"bubble\", \n          position: \"bottom-right\", \n          duration : 2000\n      });\n      this.errors = ''\n\n    },\n    handleFilesUpload () {\n      const allowedTypes = ['image/jpeg','image/png',\"image/gif\",'image/svg'];\n        let isError = true\n        this.messageError = \"\";\n        \n        let checkFilesUpload = this.$refs.files.files\n        let vm = this\n        // validate file\n        for (var i = 0; i < checkFilesUpload.length; i++) {\n          if(allowedTypes.includes(checkFilesUpload[i].type)){\n            isError = false\n          }else{\n            this.messageError = \"Định dạng không cho phép\\nĐịnh dạng hình ảnh bao gồm image/jpeg || image/png || image/gif  \";\n          }\n\n        }\n        \n        \n        if(!isError){\n          let uploadedFiles = this.$refs.files.files\n          for (var i = 0; i < uploadedFiles.length; i++) {\n            let reader = new FileReader()\n            reader.onload = function () {\n              vm.files.push({image: reader.result, file: reader.fileName})\n            }\n            reader.fileName = uploadedFiles[i].name\n            reader.readAsDataURL(uploadedFiles[i])\n          }\n       }\n\n    },\n    removeFile (key) {\n      this.files.splice(key, 1)\n    },\n    removeImage (key) {\n      this.files.splice(key, 1)\n    },\n    close(){\n       this.messageError = \"\";\n       this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow');\n    },\n    addNewDrugRecord(){\n     this.NewDrugs.push({\n        name:'',\n        id_record:'',\n        total:'',\n        morning:'',\n        midday:'',\n        afternoon:'',\n        night:'',\n        note:'',\n        user:null\n     })\n    },\n    removeNewDrugRecord(index){\n      this.NewDrugs.splice(index, 1);\n    },\n    refresh(){\n       this.doctor_email_record = ''\n       this.doctor_right_record = ''\n    },\n      async getUserRecords(){\n        try {\n            const response = (await DoctorService.getUserRecords({\n                email: this.doctor_email_record,\n                right: this.doctor_right_record\n            })).data\n            this.$store.dispatch(\"set_patientInfo\",response)    \n            const _patientrecords = (await PatientService.show(response.id_account)).data\n            this.$store.dispatch(\"update_inforRecordsPatientDetail\",_patientrecords)\n            this.isWriteRecord = true;\n            this.Istruycap = true;\n        }catch (error) {\n            this.error_access_record = error.response.data.error\n            }\n      },\n      end(){\n        this.Istruycap = false\n        this.messageError = \"\",\n        this.isWriteRecord = false\n        this.$store.dispatch(\"resetPatient_records\");\n        localStorage.removeItem('patient_records');\n      },\n      resetForm(){\n            this.doctor_email_record = '',\n            this.doctor_right_record='',\n            // this.isWriteRecord=false,\n            this.error_access_record=null,\n            this.titleRecord='',\n            this.diagnoseRecord='',\n            // this.Istruycap = false,\n            this.errors = [],\n            this.idRecord = null,\n            this.NewDrugs=[\n              {\n                name:'',\n                id_record:'',\n                total:'',\n                morning:'',\n                midday:'',\n                afternoon:'',\n                night:'',\n                note:'',            \n              }\n            ]\n            this.describe = '',\n            this.files = [],\n            this.isHideNewAlternativeRecord = true\n          this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow')     \n      },\n      async save(){\n                try {\n                    const response = (await DoctorService.saveRecord({\n                    id_patient: this.patientInfo.id_account,\n                    id_doctor: this.user.id,\n                    patient_title:this.titleRecord,\n                    patient_location:this.hospitalInfo.name_hospital,\n                    patient_time: new Date().toISOString().slice(0,10),\n                    patient_content: this.diagnoseRecord\n                    })).data\n                    this.idRecord = response.id\n      \n                    this.NewDrugs.forEach(element => {\n                      element.id_record = this.idRecord\n                    });\n\n                }catch (error) {\n                    this.error = error.response.data.error\n                    }\n\n              if(this.NewDrugs){\n                try {\n                    const length =  this.NewDrugs.length\n                    const response = await DoctorService.saveDrugRecord({\n                      objects_drug:this.NewDrugs,\n                       length:length\n                    })\n                }catch (error) {\n                    this.error = error.response.data.error\n                    }\n              }\n    \n                if(this.files){\n                  try {\n                    let length =  this.files.length\n                    const response = await DoctorService.saveAlternativeRecords({\n                      objects_files:this.files,\n                      describe:this.describe,\n                      id_record:this.idRecord,\n                      length:length,\n                    })\n                }catch (error) {\n                    this.error = error.response.data.error\n                    }\n                }\n                  this.$toasted.show(`Thành công !!`, { \n                    theme: \"bubble\", \n                    position: \"bottom-right\", \n                    duration : 2000\n                });\n                // this.getUserRecords();\n                this.resetForm()\n\n                \n      }\n  },\n}\n",{"version":3,"sources":["Doctor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA","file":"Doctor.vue","sourceRoot":"src/components/content","sourcesContent":["<template>\n  <div>\n      <div class=\"container pt-5 mb-5\" v-if=\"isUserLoggedIn\">\n        <div class=\"search\" v-bind:class=\"{ CenterCSS: !this.Istruycap }\">\n          <h3 class=\"text-center title\">TÌM KIẾM BỆNH NHÂN  testing@gmail.com</h3>\n          <div class=\"content m-auto\">\n            <div class=\"col-md-12 col-sm-12 row\" v-if=\"isWriteRecord\">\n              <div class=\"p-2 col-sm-6 text-right\">\n                <!-- THEM HO SO MOI -->\n                  <div class=\"btn btn-success\" v-b-modal.modal-1>Thêm mới hồ sơ </div>\n                  \n                  <b-modal id=\"modal-1\" title=\"Thêm bệnh án bệnh nhân\">\n                    <div class=\"row col-sm-12\">\n                        <div class=\"col-sm-4 p-2\">Triệu chứng, lý do</div>\n                        <div class=\"col-sm-8 p-2\">\n                          <input type=\"text\"  style=\"width:100%;\"  v-model=\"titleRecord\" class=\"pl-1\">\n                        </div>\n                    </div>\n                    <div class=\"row col-sm-12\">\n                        <div class=\"col-sm-4 p-2\">Chẩn đoán</div>\n                        <div class=\"col-sm-8 p-2\">\n                          <input type=\"text\"  style=\"width:100%;\"  v-model=\"diagnoseRecord\" class=\"pl-1\">\n                        </div>\n                    </div>\n                    <div class=\"row col-sm-12 text-left\">\n                      <div class=\"col-sm-12 d-flex\">\n                          <div class=\"add pb-3\" @click=\"addNewDrugRecord\">\n                            <img src=\"@/assets/images/plus.svg\" />\n                          </div>\n                          <div class=\"add add2 pb-3 pl-4\" @click=\"isHideNewAlternativeRecord = false \" v-show='isHideNewAlternativeRecord'>\n                            <img src=\"@/assets/images/add-image.svg\" />\n                          </div>\n                      </div>\n                <span style=\"width:100%\"  v-if=\"!isHideNewAlternativeRecord\">\n                  <div class=\"form col-sm-12 col-md-12 mb-2\">\n                        <div class=\"row pb-2 mx-1 justify-content-between\">\n                          <strong class=\"colorFile\">File Image </strong>\n                          <div class=\"close\" @click=\"isHideNewAlternativeRecord = true, messageError = '' \">x</div>\n                        </div>\n                          <div class=\"row pb-2\">\n                                <div class=\"col-sm-3\">\n                                  <label>Chọn File <input type=\"file\" multiple ref=\"files\" id=\"files\" accept=\"image/*\" @change=\"handleFilesUpload()\" /></label>\n                                </div> \n                                <div class=\"col-sm-9\">\n                                  <button v-on:click=\"addFiles()\">Add Files</button>\n                                </div>\n                                <div class=\"alert-error p-2\" v-if=\"messageError\">{{messageError}}</div>\n                          </div>\n      <hr>                   \n                          <div class=\"row\">\n                                <div class=\"col-sm-12\">\n                                  <textarea v-model=\"describe\" placeholder=\"Mô tả\"></textarea>\n                                </div>\n                          </div>\n      <hr>                   \n                          <div class=\"row mx-1\" v-if=\"files\">\n                            <div v-for=\"(file, key) in files\" class=\"file-listing d-flex justify-content-between py-1 d-block\">          \n                                <img class=\"preview\" :src=\"file.image\" />\n                                <span class=\"d-flex align-items-center name-preview\">{{ file.file }}</span>\n                                <span class=\"d-flex align-items-center btn btn-sm btn-warning pointer \" @click=\"removeImage( key )\">\n                                  Xóa\n                                </span>\n                            </div>\n                          </div>\n                        </div>\n                  </span>\n\n                      <div class=\"form col-sm-12 col-md-12 mb-2\" v-for=\"(newDrug,index) in NewDrugs\" :key=\"index +'-key'\">\n                        <!-- <div class=\"row justify-content-end mr-3 \"></div> -->\n                      <div class=\"row pb-2 mx-1 justify-content-between\">\n                        <strong class=\"colorDrug\">STT Drug {{index+1}}</strong>\n                        <div class=\"close\" @click=\"removeNewDrugRecord(index)\">x</div>\n                      </div>\n                        <div class=\"row pb-2\">\n                              <div class=\"col-sm-3\">Tên thuốc</div>\n                              <div class=\"col-sm-9\">\n                                <input type=\"text\"  style=\"width:100%;\"  v-model=\"newDrug.name\" class=\"pl-1\">\n                              </div>                   \n                        </div>\n                        <div class=\"row\">\n                              <div class=\"col-sm-3\">Số lượng</div>\n                              <div class=\"col-sm-9 \">\n                                <input type=\"number\" min=\"0\"  style=\"width:100%;\"   v-model=\"newDrug.total\" class=\"pl-1\">\n                              </div>\n                        </div> \n    <hr>\n                        <div class=\"row\">\n                              <div class=\"col-sm-3\">\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.morning\" placeholder=\"Sáng\">\n                              </div>\n                              <div class=\"col-sm-3\">\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.midday\" placeholder=\"Trưa\">\n                              </div>\n                              <div class=\"col-sm-3\">\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.afternoon\" placeholder=\"Chiều\">\n                              </div>\n                              <div class=\"col-sm-3\">\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.night\" placeholder=\"Tối\">\n                              </div>\n                        </div> \n    <hr>                   \n                        <div class=\"row\">\n                              <div class=\"col-sm-12\">\n                                <textarea v-model=\"newDrug.note\" placeholder=\"Ghi chú\"></textarea>\n                              </div>\n                        </div>\n                      </div>\n                    </div>\n                        <template slot=\"modal-footer\">\n                          <b-button size=\"sm\" variant=\"success\" @click=\"checkForm()\">\n                            Lưu hồ sơ\n                          </b-button>\n                          <b-button size=\"sm\" variant=\"danger\" @click=\"close()\">\n                            Hủy{{this.NewDrugs.id_record}}\n                          </b-button>\n                        </template>\n                    \n                  </b-modal>\n                  \n              </div>\n              <div class=\"p-2 col-sm-6\">\n                <b-button variant=\"secondary\" @click=\"end\">Kết thúc</b-button>\n              </div>\n            </div>\n            <span v-else>\n                <div class=\"col-md-12 col-sm-12 row\" v-if=\"doctorInfo\">\n                  <div class=\"pb-3 col-sm-12 text-right\">Xin chào bác sĩ {{doctorInfo.firstname}} {{doctorInfo.lastname}}\n\n                    <b-dropdown size=\"sm\" dropleft variant=\"link\" toggle-class=\"text-decoration-none\" no-caret>\n                      <template v-slot:button-content>\n                        &#9656;<span class=\"sr-only\">Search</span>\n                      </template>\n                      <b-dropdown-item v-b-modal.modal-3>Đổi Mật Khẩu</b-dropdown-item>\n                    </b-dropdown>\n\n                      <b-modal id=\"modal-3\" title=\"Đổi Mật Khẩu\">\n                        <b class=\"my-4 d-flex justify-content-start\">Nhập Mật Khẩu Bạn Muốn Đổi:</b>\n                        <p class=\"my-4\"><input type=\"password\" placeholder=\"nhập mật khẩu\" class=\"inputStyle\" v-model=\"passwordchangeValue\"></p>\n                        <p class=\"my-4\"><input type=\"password\" placeholder=\"nhập lại mật khẩu\" class=\"inputStyle\" v-model=\"passwordchangeValueAgain\"></p>\n                        <template v-slot:modal-footer>\n                          <div class=\"w-100\">\n                            <b-button\n                              variant=\"warning\"\n                              size=\"sm\"\n                              class=\"float-right ml-3\"\n                              @click=\"validationPasswordChange\"\n                            >\n                              Gửi Yêu Cầu Đổi Mật Khẩu\n                            </b-button>\n                            \n                            <b-button\n                              variant=\"primary\"\n                              size=\"sm\"\n                              class=\"float-right\"\n                              @click=\"closeModal3\"\n                            >\n                              Đóng\n                            </b-button>\n                          </div>\n                        </template>\n                      </b-modal>\n\n                  </div>\n                \n                </div>\n                <div class=\"col-md-12 col-sm-12 row\">\n                  <div class=\"p-2 col-sm-6 text-right\">Nhập username bệnh nhân:</div>\n                  <div class=\"p-2 col-sm-6\"><input type=\"text\" style=\"width:60%;\" v-model=\"doctor_email_record\" ></div>\n                </div>\n                <div class=\"col-md-12 col-sm-12 row pb-3\">\n                  <div class=\"p-2 col-sm-6 text-right\">Nhập quyền truy cập (nếu có):</div>\n                  <div class=\"p-2 col-sm-6\"><input type=\"text\"  style=\"width:60%;\" v-model=\"doctor_right_record\" ></div>\n                </div>\n                <div v-if=\"error_access_record\" class=\"alert-error\">{{error_access_record}}</div>\n                <div class=\"d-flex justify-content-center btn-cus\">\n                  <div class=\"btn btn-success mr-2\" @click=\"getUserRecords\">Truy Cập</div>\n                  <div class=\"btn cancel-btn ml-2\" @click=\"refresh\">Làm mới</div>\n                </div>\n            </span>\n          </div>\n        </div>\n\n        <div class=\"search\" v-if=\"this.Istruycap\">\n          <h3 class=\"text-center title\">Hồ sơ bệnh nhân</h3>\n            <div class=\"content\">\n              <div>\n                  <b-tabs card >\n                  <b-tab title=\"Hồ Sơ Bệnh Án\" active><app-TimeLine /></b-tab>\n                  <b-tab title=\"Dữ Liệu Bệnh Nhân\"><app-PatientData /></b-tab>\n              </b-tabs>\n\n            </div>\n            </div>\n\n        </div>\n          \n      </div>\n      <div v-else>\n        <app-PageNotFound />\n      </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters} from \"vuex\";\nimport DoctorService from '@/services/DoctorService'\nimport PageNotFound from '@/components/content/PageNotFound.vue'\nimport PatientView from '@/components/content/patient_modules/PatientView.vue'\nimport PatientData from '@/components/content/patient_modules/PatientData.vue'\nimport PatientService from '@/services/PatientService'\nimport HospitalService from '@/services/HospitalService'\nexport default {\n  data(){\n        return{\n            messageError:'',\n            doctor_email_record:'',          \n            doctor_right_record:'',\n            isWriteRecord:false,\n            error_access_record:null,\n            titleRecord:'',\n            diagnoseRecord:'',\n            errors: null,\n            Istruycap:false,\n            idRecord:null,\n            describe:'',\n            passwordchangeValue:'',\n            passwordchangeValueAgain:'',\n            get isUserLoggedIn() {\n                return localStorage.getItem('isUserLoggedIn' || false);\n              },\n            NewDrugs:[\n              {\n                name:'',\n                id_record:'',\n                total:'',\n                morning:'',\n                midday:'',\n                afternoon:'',\n                night:'',\n                note:'',\n              }\n            ],\n            \n            files: [],\n            isHideNewAlternativeRecord:true\n        }\n    },\n      computed: {\n        ...mapGetters([\"patient_records\",\"doctorInfo\",\"hospitalInfo\",\"patientInfo\"])\n      },\n      components: {\n        \"app-TimeLine\": PatientView,  \n        \"app-PatientData\": PatientData,\n        \"app-PageNotFound\":PageNotFound\n      },\n    async mounted() {\n        const userCONST = JSON.parse(localStorage.getItem('user'));\n        if(userCONST){\n          this.user = userCONST\n          const id_account = JSON.parse(localStorage.getItem('user')).id;\n\n          const payload_doctor = (await DoctorService.getInfoDoctor(id_account)).data\n          this.$store.dispatch(\"setDoctorInfo\",payload_doctor)\n\n          const payload_hospital = (await HospitalService.getInfoHospital(payload_doctor.id_hospital)).data\n          this.$store.dispatch(\"setHospitalInfo\",payload_hospital)\n        }\n        \n      },\n  methods: {\n      validationPasswordChange(){\n        if(!this.passwordchangeValue || !this.passwordchangeValueAgain){\n            this.$toasted.show('Vui Lòng Nhập Đầy Đủ Thông Tin !!!', { \n            theme: \"bubble\",\n            position: \"bottom-right\", \n            duration : 4000\n        });\n        }else if(this.passwordchangeValue !== this.passwordchangeValueAgain){\n          this.$toasted.show(`Mật Khẩu Và Mật Khẩu Xác Nhận Không Giống Nhau !!!<br>Vui Lòng Kiểm Tra Lại !!!`, { \n            theme: \"bubble\", \n            position: \"bottom-right\", \n            duration : 5000\n        });\n        }else if(this.passwordchangeValue.length < 8){\n          this.$toasted.show(`Mật khẩu được cung cấp phải khớp với các quy tắc sau:\\n            <br><br>\\n            1. Nó phải chứa chỉ các ký tự sau: chữ thường, chữ hoa, chữ số.\\n            <br><br>\\n            2. mật khẩu dài ít nhất 8 kí tự và không dài hơn 32 kí tự.\\n            </div>\\n        `, { \n            theme: \"bubble\", \n            position: \"bottom-right\", \n            duration : 4000\n        });\n        }else{\n          this.changepassword();\n          this.closeModal3();\n        }\n    },\n    closeModal3(){\n        this.passwordchangeValue = ''\n        this.passwordchangeValueAgain = ''\n        this.$root.$emit('bv::hide::modal', \"modal-3\", \"button\")\n      },\n    async changepassword(){\n        try {\n            await PatientService.changePassword({\n              id_account:this.user.id,\n              password:this.passwordchangeValue\n          })\n        } catch (error) {\n          this.ErrorToasted(error)\n        }\n\n            this.$toasted.show(`Cập Nhập Thành công !!`, { \n              theme: \"bubble\",\n              position: \"bottom-right\", \n              duration : 3000\n          });\n      },\n    addFiles(){\n      this.$refs.files.click()\n    },\n    checkForm: function (e) {\n      if (this.titleRecord && this.diagnoseRecord) {\n        this.save()\n      }\n      this.errors = '';\n\n      if (!this.titleRecord) {\n        this.errors += 'Vui lòng nhập triệu chứng, lý do. <br> ';\n      }\n      if (!this.diagnoseRecord) {\n        this.errors += 'Vui lòng nhập chẩn đoán.';\n      }\n        this.$toasted.show(`${this.errors}`, {\n          theme: \"bubble\", \n          position: \"bottom-right\", \n          duration : 2000\n      });\n      this.errors = ''\n\n    },\n    handleFilesUpload () {\n      const allowedTypes = ['image/jpeg','image/png',\"image/gif\",'image/svg'];\n        let isError = true\n        this.messageError = \"\";\n        \n        let checkFilesUpload = this.$refs.files.files\n        let vm = this\n        // validate file\n        for (var i = 0; i < checkFilesUpload.length; i++) {\n          if(allowedTypes.includes(checkFilesUpload[i].type)){\n            isError = false\n          }else{\n            this.messageError = \"Định dạng không cho phép\\nĐịnh dạng hình ảnh bao gồm image/jpeg || image/png || image/gif  \";\n          }\n\n        }\n        \n        \n        if(!isError){\n          let uploadedFiles = this.$refs.files.files\n          for (var i = 0; i < uploadedFiles.length; i++) {\n            let reader = new FileReader()\n            reader.onload = function () {\n              vm.files.push({image: reader.result, file: reader.fileName})\n            }\n            reader.fileName = uploadedFiles[i].name\n            reader.readAsDataURL(uploadedFiles[i])\n          }\n       }\n\n    },\n    removeFile (key) {\n      this.files.splice(key, 1)\n    },\n    removeImage (key) {\n      this.files.splice(key, 1)\n    },\n    close(){\n       this.messageError = \"\";\n       this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow');\n    },\n    addNewDrugRecord(){\n     this.NewDrugs.push({\n        name:'',\n        id_record:'',\n        total:'',\n        morning:'',\n        midday:'',\n        afternoon:'',\n        night:'',\n        note:'',\n        user:null\n     })\n    },\n    removeNewDrugRecord(index){\n      this.NewDrugs.splice(index, 1);\n    },\n    refresh(){\n       this.doctor_email_record = ''\n       this.doctor_right_record = ''\n    },\n      async getUserRecords(){\n        try {\n            const response = (await DoctorService.getUserRecords({\n                email: this.doctor_email_record,\n                right: this.doctor_right_record\n            })).data\n            this.$store.dispatch(\"set_patientInfo\",response)    \n            const _patientrecords = (await PatientService.show(response.id_account)).data\n            this.$store.dispatch(\"update_inforRecordsPatientDetail\",_patientrecords)\n            this.isWriteRecord = true;\n            this.Istruycap = true;\n        }catch (error) {\n            this.error_access_record = error.response.data.error\n            }\n      },\n      end(){\n        this.Istruycap = false\n        this.messageError = \"\",\n        this.isWriteRecord = false\n        this.$store.dispatch(\"resetPatient_records\");\n        localStorage.removeItem('patient_records');\n      },\n      resetForm(){\n            this.doctor_email_record = '',\n            this.doctor_right_record='',\n            // this.isWriteRecord=false,\n            this.error_access_record=null,\n            this.titleRecord='',\n            this.diagnoseRecord='',\n            // this.Istruycap = false,\n            this.errors = [],\n            this.idRecord = null,\n            this.NewDrugs=[\n              {\n                name:'',\n                id_record:'',\n                total:'',\n                morning:'',\n                midday:'',\n                afternoon:'',\n                night:'',\n                note:'',            \n              }\n            ]\n            this.describe = '',\n            this.files = [],\n            this.isHideNewAlternativeRecord = true\n          this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow')     \n      },\n      async save(){\n                try {\n                    const response = (await DoctorService.saveRecord({\n                    id_patient: this.patientInfo.id_account,\n                    id_doctor: this.user.id,\n                    patient_title:this.titleRecord,\n                    patient_location:this.hospitalInfo.name_hospital,\n                    patient_time: new Date().toISOString().slice(0,10),\n                    patient_content: this.diagnoseRecord\n                    })).data\n                    this.idRecord = response.id\n      \n                    this.NewDrugs.forEach(element => {\n                      element.id_record = this.idRecord\n                    });\n\n                }catch (error) {\n                    this.error = error.response.data.error\n                    }\n\n              if(this.NewDrugs){\n                try {\n                    const length =  this.NewDrugs.length\n                    const response = await DoctorService.saveDrugRecord({\n                      objects_drug:this.NewDrugs,\n                       length:length\n                    })\n                }catch (error) {\n                    this.error = error.response.data.error\n                    }\n              }\n    \n                if(this.files){\n                  try {\n                    let length =  this.files.length\n                    const response = await DoctorService.saveAlternativeRecords({\n                      objects_files:this.files,\n                      describe:this.describe,\n                      id_record:this.idRecord,\n                      length:length,\n                    })\n                }catch (error) {\n                    this.error = error.response.data.error\n                    }\n                }\n                  this.$toasted.show(`Thành công !!`, { \n                    theme: \"bubble\", \n                    position: \"bottom-right\", \n                    duration : 2000\n                });\n                // this.getUserRecords();\n                this.resetForm()\n\n                \n      }\n  },\n}\n</script>\n\n<style scoped>\n* {\n  font-family: Arial, Helvetica, sans-serif;\n  font-size: 14px;\n}\n.title{\n  margin: 0;\n  border-bottom: none !important;\n  background: #40c4ff;\n  color:white;\n}\n.search h3{\n  padding:0.5rem;\n  border: 2px solid #40c4ff;\n}\n.content{\n  padding:0.5rem;\n  border: 2px solid #40c4ff;\n}\ninput{\n  border:1px solid rgb(0, 0, 0,.3);\n  border-radius: 2px;\n}\n.btn-cus{\n  padding-left: 28vw;\n}\n.cancel-btn{\n    border: 1px solid #ccd0d5;\n    border-radius: 2px;\n    background-color: #f5f6f7;\n    cursor: pointer;\n}   \n.card-header-tabs{\n  padding: 10rem;\n  color: red;\n}\n.alert-error{\n  text-align: center;\n  color: red;\n}\n.add img{\n  height: 2rem;\n  width: 2rem;\n  border-radius: 50%;\n}\n.add2 img{\n  border-radius: 0;\n}\n.add{\n  cursor: pointer;\n}\n.add img:hover{\n    -webkit-box-shadow: 2px 2px 15px 0px rgba(183,214,240,1);\n    -moz-box-shadow: 2px 2px 15px 0px rgba(183,214,240,1);\n    box-shadow: 2px 2px 15px 0px rgba(183,214,240,1);\n}\n.close{\n  cursor: pointer;\n}\n.close:hover{\n    -webkit-box-shadow: 2px 2px 5px 0px rgba(183,214,240,1);\n    -moz-box-shadow: 2px 2px 5px 0px rgba(183,214,240,1);\n    box-shadow: 2px 2px 5px 0px rgba(183,214,240,1);\n}\ntextarea\n{\n  width:100%;\n}\n.form{\n  padding:0.5rem;\n  border: 1px solid rgb(0, 0, 0,.4)\n}\n.danger-alert{\n  color:red\n}\n.Custominput img {\n  max-width: 100%;\n  max-height: 500px;\n}\n.colorDrug{\n  color: #F44336;\n}\n.colorFile{\n  color:#9C27B0;\n}\ninput[type=\"file\"]{\n  position: absolute;\n  top: -500px;\n}\ndiv.file-listing img{\n  max-width: 40%;\n}\n.name-preview{\n  border:1px solid rgb(170, 170, 170,.3);\n  padding:0.5rem;\n  overflow: overlay;\n  max-width: 300px;\n  word-wrap: break-word;\n}\n.pointer{\n  cursor: pointer;\n}\n.CenterCSS{\n  margin-bottom: 10vh;\n  margin-top: 9vh;\n}\n.inputStyle{\n  padding: 0.25rem;\n  border:1px solid #aaa;\n  border-radius:4px;\n  width:100%;\n}\n</style>\n"]}]}